<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIXYEEZ Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">ðŸ‘‘</span>
                    <div>
                        <h2>WIXYEEZ</h2>
                        <span>Admin Panel</span>
                    </div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="/admin/dashboard" class="nav-item active">
                    <span class="nav-icon">ðŸ“Š</span>
                    Dashboard
                </a>
                <a href="/admin/products" class="nav-item">
                    <span class="nav-icon">ðŸ“¦</span>
                    Products
                </a>
                <a href="#" class="nav-item" id="logoutBtn">
                    <span class="nav-icon">ðŸšª</span>
                    Logout
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <h1>Dashboard</h1>
                <div class="header-user">
                    <span id="adminUsername">Admin</span>
                </div>
            </header>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ðŸ“¦</div>
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Total Products</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ðŸ›’</div>
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ðŸ’°</div>
                    <div class="stat-value" id="totalRevenue">0â‚½</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ðŸ“ˆ</div>
                    <div class="stat-value" id="todayOrders">0</div>
                    <div class="stat-label">Today's Orders</div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="section-card">
                <h2>Quick Actions</h2>
                <div class="quick-actions">
                    <a href="/admin/products" class="action-btn">
                        <span>âž•</span> Add Product
                    </a>
                    <button class="action-btn" onclick="refreshStats()">
                        <span>ðŸ”„</span> Refresh Stats
                    </button>
                </div>
            </div>
            
            <!-- Category Breakdown -->
            <div class="section-card">
                <h2>Products by Category</h2>
                <div id="categoryBreakdown" class="category-list">
                    <p>Loading...</p>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Check auth
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('admin_logged_in');
            const username = localStorage.getItem('admin_username');
            
            if (!isLoggedIn) {
                window.location.href = '/admin/login';
                return false;
            }
            
            if (username) {
                document.getElementById('adminUsername').textContent = username;
            }
            
            return true;
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('admin_logged_in');
            localStorage.removeItem('admin_username');
            window.location.href = '/admin/login';
        });
        
        // Load stats
        async function loadDashboard() {
            if (!checkAuth()) return;
            
            try {
                const response = await fetch('/api/stats.php', {
                    credentials: 'include'
                });
                
                if (response.status === 401) {
                    localStorage.removeItem('admin_logged_in');
                    window.location.href = '/admin/login';
                    return;
                }
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalProducts').textContent = data.stats.products;
                    document.getElementById('totalOrders').textContent = data.stats.orders;
                    document.getElementById('totalRevenue').textContent = Math.round(data.stats.revenue) + 'â‚½';
                    document.getElementById('todayOrders').textContent = data.stats.today_orders;
                    
                    // Category breakdown
                    const categoryBreakdown = document.getElementById('categoryBreakdown');
                    if (data.stats.categories && data.stats.categories.length > 0) {
                        categoryBreakdown.innerHTML = data.stats.categories.map(cat => `
                            <div class="category-item">
                                <span class="category-name">
                                    ${getCategoryEmoji(cat.category)} ${cat.category}
                                </span>
                                <span class="category-count">${cat.count}</span>
                            </div>
                        `).join('');
                    } else {
                        categoryBreakdown.innerHTML = '<p>No categories yet</p>';
                    }
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }
        
        function getCategoryEmoji(category) {
            const emojis = {
                'Ð£ÑÐ»ÑƒÐ³Ð¸': 'ðŸ›¡ï¸',
                'Ð¡ÐµÑ‚Ñ‹': 'ðŸ“¦',
                'Ð¡Ð¾Ð¿Ñ€Ð¾Ð²Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ': 'ðŸŽ¯'
            };
            return emojis[category] || 'ðŸ”¥';
        }
        
        function refreshStats() {
            loadDashboard();
            alert('Stats refreshed!');
        }
        
        // Load on page load
        window.addEventListener('DOMContentLoaded', () => {
            if (checkAuth()) {
                loadDashboard();
            }
        });
    </script>
</body>
</html>
