<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIXYEEZ Admin - Login</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="login-page">
    <div class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <div class="logo-icon">üëë</div>
                <h1>WIXYEEZ</h1>
                <p>Admin Panel</p>
            </div>
            
            <!-- Debug Panel -->
            <div id="debugPanel" style="background: #f0f0f0; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 12px; color: #333; display: none;">
                <strong>üîç Debug Log:</strong>
                <div id="debugLog" style="margin-top: 10px; max-height: 150px; overflow-y: auto;"></div>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" placeholder="admin" value="admin" required>
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="admin123" value="admin123" required>
                </div>
                
                <div id="errorMessage" class="error-message"></div>
                
                <button type="submit" class="btn-login" id="loginBtn">
                    Login ‚Üí
                </button>
                
                <button type="button" class="btn-secondary" onclick="toggleDebug()" style="width: 100%; margin-top: 10px; padding: 10px; background: #e0e0e0; border: none; border-radius: 8px; cursor: pointer;">
                    üîç Show Debug
                </button>
            </form>
            
            <div class="login-footer">
                <p>Default: admin / admin123</p>
            </div>
        </div>
    </div>
    
    <script>
        let debugMode = false;
        
        function toggleDebug() {
            debugMode = !debugMode;
            document.getElementById('debugPanel').style.display = debugMode ? 'block' : 'none';
        }
        
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('debugLog');
            const time = new Date().toLocaleTimeString();
            const colors = {
                info: '#0066cc',
                success: '#00aa00',
                error: '#cc0000'
            };
            logDiv.innerHTML += `<div style="color: ${colors[type]}; margin: 5px 0;">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        // Test API on load
        window.addEventListener('DOMContentLoaded', async () => {
            addLog('üì± Page loaded on Android');
            
            // Test API connection
            try {
                addLog('üîå Testing API connection...');
                const response = await fetch('/api');
                addLog(`‚úÖ API Status: ${response.status}`);
                const data = await response.json();
                addLog(`üì¶ API Response: ${JSON.stringify(data)}`);
            } catch (error) {
                addLog(`‚ùå API Error: ${error.message}`, 'error');
            }
        });
        
        // Login handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorEl = document.getElementById('errorMessage');
            const loginBtn = document.getElementById('loginBtn');
            
            // Show debug panel
            document.getElementById('debugPanel').style.display = 'block';
            debugMode = true;
            
            // Disable button
            loginBtn.disabled = true;
            loginBtn.textContent = 'Loading...';
            errorEl.style.display = 'none';
            
            addLog('üîê Login attempt started');
            addLog(`üë§ Username: ${username}`);
            
            try {
                addLog('üì° Sending request to /api/login.php');
                
                const response = await fetch('/api/login.php', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                addLog(`üì• Response status: ${response.status}`, response.ok ? 'success' : 'error');
                
                const data = await response.json();
                addLog(`üì¶ Response data: ${JSON.stringify(data)}`);
                
                if (data.success) {
                    addLog('‚úÖ Login successful!', 'success');
                    
                    // Save to localStorage
                    localStorage.setItem('admin_logged_in', 'true');
                    localStorage.setItem('admin_username', data.username);
                    addLog('üíæ Saved to localStorage');
                    
                    // Show success message
                    errorEl.style.display = 'block';
                    errorEl.style.background = '#d4edda';
                    errorEl.style.color = '#155724';
                    errorEl.textContent = '‚úÖ Login successful! Redirecting...';
                    
                    addLog('üîÑ Redirecting to dashboard...');
                    
                    // Redirect after 2 seconds
                    setTimeout(() => {
                        window.location.href = '/admin/dashboard';
                    }, 2000);
                } else {
                    addLog(`‚ùå Login failed: ${data.error}`, 'error');
                    errorEl.textContent = data.error || 'Login failed';
                    errorEl.style.display = 'block';
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Login ‚Üí';
                }
            } catch (error) {
                addLog(`‚ùå Connection error: ${error.message}`, 'error');
                errorEl.textContent = 'Connection error: ' + error.message;
                errorEl.style.display = 'block';
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login ‚Üí';
            }
        });
    </script>
</body>
</html>
